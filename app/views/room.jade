h2 #{display}
#mapChatContainer
	#chatContainer
		#chat
			p Connecting...

		form(id="form")
		  input(type="text", autocomplete="off", id="text")
			input(type="submit", value="Send")

	div
		#canvasContainer
			canvas(id="background", width="700", height="700")
			//drawing the actual map image here
			
			canvas(id="shadow", width="700", height="700")
			canvas(id="shadowDrag", width="700", height="700")
			//new shadows while dragging are drawn here
			
			canvas(id="map", width="700", height="700") 
			//the PC images "live" here 
			
			canvas(id="top", width="700", height="700") 
			//dragging player images
			canvas(id="annotations", width="700", height="700")
			textarea(id="textArea", rows="5", cols="14") //using this as a drop target

#toolContainer
#players
	h3 Players
	- each playerObj, playerName in players
		.playerBlock
			img(class="playerImg", src= playerObj.src, id="player_" + playerObj.name)
			div(id=playerObj.name)
				.innerChat
					a(href="#", class="chatLink", id= playerObj.name) #{playerObj.name}

div.clear
#privateChat
	p Connecting

	form(id="privateForm")
	input(type="text", autocomplete="off", id="privateInput")
	input(type="submit", value="Send")

.scripts
	:javascript
		|	var currentTime = new Date(),
		|			secs = currentTime.getTime();
		| head.js("/lib/room.js?v=" + secs, 
		|					"/lib/base64.js",
		|					"/lib/canvas2Image.js",
		| function() {
		| 	_listenId = "#{listenId}";
		|		_websocketId = "#{websocketId}";
		|		_default = "#{useDefault}";
		|		_image = "#{imageName}";
		|		_userName = "#{userName}";
		|		_url = "#{url}";
		|		_isDM = #{isDM}? true : false;
		|		_isKnown = #{isKnown}? true : false;
		|		_toolBar = '#{dmPaletteOrNothing}';
		|		$("div#toolContainer").html(_toolBar);
		|		if (!_isKnown) { return initUnknown(); }
		|		return initRoom();
		|	});	